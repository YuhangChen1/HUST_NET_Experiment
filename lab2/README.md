# Lab 2: SDN è‡ªå­¦ä¹ ä¸ç¯è·¯æ£€æµ‹å®éªŒ ğŸŒ

## ğŸ“š å®éªŒæ¦‚è¿°

æœ¬å®éªŒåŸºäº OpenFlow/OS-Ken æ§åˆ¶å™¨ä¸ Mininet ä»¿çœŸç¯å¢ƒæ„å»ºè½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSDNï¼‰ï¼Œå®ç°äº¤æ¢æœºè‡ªå­¦ä¹ å’Œç¯è·¯å¹¿æ’­é˜²æ²»ã€‚

### ğŸ¯ å®éªŒä»»åŠ¡

- âœ… **ä»»åŠ¡ä¸€**ï¼šå®ç°äº¤æ¢æœºè‡ªå­¦ä¹ ï¼ˆ`self_learning_switch.py`ï¼‰
- âœ… **ä»»åŠ¡äºŒä¹‹ä¸€**ï¼šä½¿ç”¨ç«¯å£ç¦ç”¨é˜²æ­¢ç¯è·¯å¹¿æ’­ï¼ˆ`loop_breaker_switch.py`ï¼‰
- âœ… **ä»»åŠ¡äºŒä¹‹äºŒ**ï¼šä½¿ç”¨è½¬å‘å†å²ä¿¡æ¯é˜²æ­¢ç¯è·¯å¹¿æ’­ï¼ˆ`loop_detecting_switch.py`ï¼‰

### ğŸ“– å®éªŒæ”¶è·

- ç†Ÿæ‚‰å¹¶æŒæ¡ç½‘ç»œå·¥å…·çš„åŸºæœ¬ä½¿ç”¨
- ç†Ÿæ‚‰å¹¶ç†è§£ SDN çš„å·¥ä½œæœºåˆ¶
- äº†è§£ SDN ä¸‹çš„è‡ªå­¦ä¹ ä¸ä¸€èˆ¬ç½‘ç»œä¸‹çš„å·®å¼‚
- äº†è§£ç¯è·¯å¹¿æ’­çš„å½¢æˆåŸå› ï¼ŒæŒæ¡ç¯è·¯å¹¿æ’­é˜²æ²»æ–¹æ³•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# è¿›å…¥ lab2 ç›®å½•
cd ~/æ¡Œé¢/lab/lab2

# ä¸€é”®è®¾ç½®ç¯å¢ƒï¼ˆæ¨èï¼‰
source setup.sh

# æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œ
uv sync
source .venv/bin/activate
```

### 2. æ·»åŠ æ‰§è¡Œæƒé™

```bash
chmod +x topo_1.py topo_2.py
```

---

## ğŸ“ ä»»åŠ¡ä¸€ï¼šè‡ªå­¦ä¹ äº¤æ¢æœº

### ğŸ¯ ä»»åŠ¡ç›®æ ‡

å®ç° MAC åœ°å€è‡ªå­¦ä¹ ï¼Œé¿å…æ— è„‘æ´ªæ³›æ‰€æœ‰ç«¯å£ã€‚

### ğŸŒ ç½‘ç»œæ‹“æ‰‘ï¼ˆtopo_1.pyï¼‰

```
    h1 --- s1 --- s2 --- h2
            |      |
            s3    s4
            |      |
            h3    h4
```

- **4 ä¸ªä¸»æœº**ï¼šh1, h2, h3, h4
- **4 ä¸ªäº¤æ¢æœº**ï¼šs1, s2, s3, s4
- **æ— ç¯è·¯**

### ğŸ”§ å®éªŒæ­¥éª¤

#### æ­¥éª¤ 1ï¼šéªŒè¯ç®€å•äº¤æ¢æœºçš„ç¼ºé™·

**ç»ˆç«¯ 1ï¼šå¯åŠ¨æ§åˆ¶å™¨**
```bash
osken-manager simple_switch.py
```

**ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘ç»œæ‹“æ‰‘**
```bash
sudo ./topo_1.py
```

**Mininet CLI ä¸­ï¼š**
```bash
# å¯åŠ¨ Wireshark æŠ“åŒ…ï¼ˆh3 ç«¯å£ï¼‰
mininet> h3 wireshark &

# h4 ping h2
mininet> h4 ping -c 3 h2
```

**è§‚å¯Ÿç°è±¡**ï¼š
- âŒ h3 ä¼šæ”¶åˆ° h4 å’Œ h2 ä¹‹é—´çš„é€šä¿¡åŒ…ï¼ˆä¸åº”è¯¥æ”¶åˆ°ï¼‰
- åŸå› ï¼š`simple_switch.py` ä½¿ç”¨æ´ªæ³›ï¼Œå‘æ‰€æœ‰ç«¯å£è½¬å‘

**æ¸…ç†ç¯å¢ƒï¼š**
```bash
mininet> exit
$ sudo mn -c
```

---

#### æ­¥éª¤ 2ï¼šæµ‹è¯•è‡ªå­¦ä¹ äº¤æ¢æœº

**ç»ˆç«¯ 1ï¼šå¯åŠ¨æ§åˆ¶å™¨**
```bash
osken-manager self_learning_switch.py
```

**ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘ç»œæ‹“æ‰‘**
```bash
sudo ./topo_1.py
```

**Mininet CLI ä¸­ï¼š**
```bash
# å¯åŠ¨ Wireshark æŠ“åŒ…ï¼ˆh3 ç«¯å£ï¼‰
mininet> h3 wireshark &

# h4 ping h2
mininet> h4 ping -c 10 h2
```
**æ³¨æ„&ç¬¦å·ä¸èƒ½ä¸¢**

**è§‚å¯Ÿç°è±¡**ï¼š
- âœ… h3 åªæ”¶åˆ° ARP å¹¿æ’­åŒ…ï¼Œä¸å†æ”¶åˆ° h4 å’Œ h2 ä¹‹é—´çš„ ICMP åŒ…
**tipï¼šICMPåŒ…ä¸æ˜¯ICMPv6åŒ… é‚£æ˜¯linuxè‡ªå·±å‘çš„**
- âœ… æ§åˆ¶å™¨ç»ˆç«¯æ˜¾ç¤ºäº”å…ƒç»„ä¿¡æ¯ï¼š`(dpid, src_mac, in_port, dst_mac, out_port)`

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
Packet matched: dpid=1, src=00:00:00:00:00:04, in_port=3, dst=00:00:00:00:00:02, out_port=1
Packet matched: dpid=1, src=00:00:00:00:00:02, in_port=1, dst=00:00:00:00:00:04, out_port=3
```

---

#### æ­¥éª¤ 3ï¼šåˆ†æ MAC åœ°å€å’Œç«¯å£å·

æ ¹æ®æ§åˆ¶å™¨è¾“å‡ºï¼Œåˆ†æï¼š

**é—®é¢˜ 1**ï¼šh2 å’Œ h4 çš„ MAC åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ
- **ç­”æ¡ˆ**ï¼šä»è¾“å‡ºå¯ä»¥çœ‹å‡º
  - h4 çš„ MACï¼š`00:00:00:00:00:04`
  - h2 çš„ MACï¼š`00:00:00:00:00:02`

**é—®é¢˜ 2**ï¼šh2 å’Œ h4 è¿æ¥åˆ°å“ªä¸ªäº¤æ¢æœºçš„å“ªä¸ªç«¯å£ï¼Ÿ
- **ç­”æ¡ˆ**ï¼š
  - h4 è¿æ¥åˆ°äº¤æ¢æœº s1 çš„ç«¯å£ 3
  - h2 è¿æ¥åˆ°äº¤æ¢æœº s1 çš„ç«¯å£ 1ï¼ˆæˆ–é€šè¿‡ s2ï¼‰

---

#### æ­¥éª¤ 4ï¼šæµ‹è¯• hard_timeout å‚æ•°

**ä¿®æ”¹ `self_learning_switch.py` ç¬¬ 82 è¡Œï¼š**

```python
# åœºæ™¯ 1ï¼šhard_timeout=0ï¼ˆæµè¡¨æ°¸ä¹…æœ‰æ•ˆï¼‰
self.add_flow(dp, 1, match, actions, hard_timeout=0)

# åœºæ™¯ 2ï¼šhard_timeout=5ï¼ˆæµè¡¨ 5 ç§’åå¤±æ•ˆï¼‰
self.add_flow(dp, 1, match, actions, hard_timeout=5)
```

**æµ‹è¯•åœºæ™¯ 1ï¼ˆhard_timeout=0ï¼‰ï¼š**
```bash
mininet> h4 ping -c 20 h2
```
- **è§‚å¯Ÿ**ï¼šåªæœ‰å‰å‡ ä¸ªåŒ…ä¼šè§¦å‘æ§åˆ¶å™¨ï¼ˆå­¦ä¹ é˜¶æ®µï¼‰ï¼Œä¹‹åæ§åˆ¶å™¨ä¸å†è¾“å‡º
- **åŸå› **ï¼šæµè¡¨æ°¸ä¹…æœ‰æ•ˆï¼Œäº¤æ¢æœºç›´æ¥è½¬å‘ï¼Œä¸ç»è¿‡æ§åˆ¶å™¨

**æµ‹è¯•åœºæ™¯ 2ï¼ˆhard_timeout=5ï¼‰ï¼š**
```bash
mininet> h4 ping -c 20 h2
```
- **è§‚å¯Ÿ**ï¼šæ¯éš” 5 ç§’ï¼Œæ§åˆ¶å™¨ä¼šå†æ¬¡è¾“å‡ºæ—¥å¿—
- **åŸå› **ï¼šæµè¡¨ 5 ç§’åå¤±æ•ˆï¼Œéœ€è¦é‡æ–°å­¦ä¹ 

---


### âœ… ä»»åŠ¡ä¸€éªŒè¯æ¸…å•

- [ ] h3 ä¸å†æ”¶åˆ° h4 å’Œ h2 ä¹‹é—´çš„ ICMP åŒ…
- [ ] æ§åˆ¶å™¨è¾“å‡ºäº”å…ƒç»„ä¿¡æ¯
- [ ] èƒ½å¤Ÿåˆ†æå‡º MAC åœ°å€å’Œç«¯å£å·
- [ ] ç†è§£ hard_timeout å‚æ•°çš„ä½œç”¨

---

## ğŸ” ä»»åŠ¡äºŒä¹‹ä¸€ï¼šç¦ç”¨ç«¯å£è§£å†³ç¯è·¯å¹¿æ’­

### ğŸ¯ ä»»åŠ¡ç›®æ ‡

é€šè¿‡ç¦ç”¨äº¤æ¢æœºç«¯å£æ‰“ç ´ç½‘ç»œç¯è·¯ã€‚

### ğŸ“– å®éªŒç›®çš„

**æœ¬ä»»åŠ¡çš„æ ¸å¿ƒç›®çš„**ï¼š
1. **è§‚å¯Ÿç¯è·¯å¹¿æ’­é—®é¢˜**ï¼šç†è§£ ARP å¹¿æ’­åœ¨ç¯è·¯ä¸­æ— é™å¾ªç¯çš„ç°è±¡
2. **å­¦ä¹ ç«¯å£ç¦ç”¨æ–¹æ³•**ï¼šæŒæ¡ä½¿ç”¨ OFPPortMod æ¶ˆæ¯ç¦ç”¨ç«¯å£
3. **è®¤è¯†æ–¹æ³•å±€é™æ€§**ï¼šä½“ä¼šåœ¨å¤æ‚æ‹“æ‰‘ä¸­ï¼Œå•ä¸€ç«¯å£ç¦ç”¨å¯èƒ½æ— æ³•å®Œå…¨è§£å†³ç¯è·¯
4. **å¯¹æ¯”ä¸¤ç§æ–¹æ¡ˆ**ï¼šä¸ºä»»åŠ¡äºŒä¹‹äºŒï¼ˆè½¬å‘å†å²æ£€æµ‹ï¼‰æä¾›å¯¹æ¯”åŸºç¡€

âš ï¸ **é‡è¦è¯´æ˜**ï¼š
- æœ¬ä»»åŠ¡ä¸­çš„ topo_2.py æ‹“æ‰‘è®¾è®¡äº†**å¤šä¸ªç›¸äº’åµŒå¥—çš„ç¯è·¯**
- ç¦ç”¨ s1 çš„å•ä¸ªç«¯å£**å¯èƒ½æ— æ³•å®Œå…¨è§£å†³ç¯è·¯é—®é¢˜**ï¼ˆè¿™æ˜¯æ•…æ„è®¾è®¡çš„ï¼‰
- è¿™æ­£æ˜¯ä¸ºäº†å±•ç¤º**ç«¯å£ç¦ç”¨æ–¹æ³•çš„å±€é™æ€§**ï¼Œå¼•å‡ºä»»åŠ¡äºŒä¹‹äºŒçš„é€šç”¨è§£å†³æ–¹æ¡ˆ

### ğŸŒ ç½‘ç»œæ‹“æ‰‘ï¼ˆtopo_2.pyï¼‰

```
    h1 --- s1 --- s2 --- h2
          /|\  
         / | \  
        s3-+-s4
        |     |
        h3    h4
```

**é“¾è·¯å…³ç³»**ï¼š
- s1-s2, s1-s3, s1-s4ï¼ˆs1 è¿æ¥å…¶ä»–ä¸‰ä¸ªäº¤æ¢æœºï¼‰
- s3-s4ï¼ˆé¢å¤–çš„ç›´è¿é“¾è·¯ï¼‰

**ç¯è·¯ç»“æ„**ï¼š
- ç¯è·¯ 1ï¼šs1 â†” s3 â†” s4 â†” s1
- ç¯è·¯ 2ï¼šs1 â†” s2 â†” ... â†” s4 â†” s1ï¼ˆé€šè¿‡å…¶ä»–è·¯å¾„ï¼‰

- **4 ä¸ªä¸»æœº**ï¼šh1, h2, h3, h4
- **4 ä¸ªäº¤æ¢æœº**ï¼šs1, s2, s3, s4
- **å­˜åœ¨å¤šä¸ªåµŒå¥—ç¯è·¯**

### ğŸ”§ å®éªŒæ­¥éª¤

#### æ­¥éª¤ 1ï¼šè§‚å¯Ÿç¯è·¯å¹¿æ’­é—®é¢˜

**ç»ˆç«¯ 1ï¼šå¯åŠ¨æ§åˆ¶å™¨**
```bash
osken-manager self_learning_switch.py
```

**ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘ç»œæ‹“æ‰‘**
```bash
sudo ./topo_2.py
```

**Mininet CLI ä¸­ï¼š**
```bash
# å°è¯• pingï¼ˆä¼šå¤±è´¥ï¼‰
mininet> h4 ping -c 3 h2
# ä¼šå‘ç°æ— æ³•æ­£å¸¸é€šä¿¡æˆ–å»¶è¿Ÿæé«˜

# æŸ¥çœ‹æµè¡¨ï¼ˆæ•°æ®åŒ…æ•°é‡å¼‚å¸¸å·¨å¤§ï¼‰
mininet> dpctl dump-flows
# è§‚å¯Ÿ n_packets å‚æ•°ï¼Œä¼šå‘ç°æ•°ç™¾ä¸‡ä¸ªåŒ…

# å¯åŠ¨ Wireshark æŠ“åŒ…
mininet> h3 wireshark &
# ä¼šçœ‹åˆ°å¤§é‡é‡å¤çš„ ARP Request åŒ…
```

**é—®é¢˜åˆ†æ**ï¼š
- âŒ ARP å¹¿æ’­åŒ…åœ¨ç¯è·¯ä¸­æ— é™å¾ªç¯
- âŒ æ·¹æ²¡äº†æ­£å¸¸é€šä¿¡çš„æ•°æ®åŒ…
- âŒ CPU ä½¿ç”¨ç‡æé«˜

**æ¸…ç†ç¯å¢ƒï¼š**
```bash
mininet> exit
$ sudo mn -c
```

---

#### æ­¥éª¤ 2ï¼šæ‰¾å‡º s1 çš„ç«¯å£å·

**ç»ˆç«¯ 1ï¼šå¯åŠ¨æ§åˆ¶å™¨**
```bash
osken-manager self_learning_switch.py
```

**ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘ç»œæ‹“æ‰‘**
```bash
sudo ./topo_2.py
```

**Mininet CLI ä¸­ï¼š**
```bash
mininet> h4 ping -c 3 h2
```

**è§‚å¯Ÿæ§åˆ¶å™¨è¾“å‡º**ï¼Œæ‰¾å‡º s1 (dpid=1) è¿æ¥ s3 å’Œ s4 çš„ç«¯å£å·ã€‚

**ç¤ºä¾‹è¾“å‡ºåˆ†æ**ï¼š
```
# å‡è®¾çœ‹åˆ°ä»¥ä¸‹è¾“å‡º
dpid=1, in_port=2, ...  # s1 çš„ç«¯å£ 2 å¯èƒ½è¿æ¥ s3
dpid=1, in_port=3, ...  # s1 çš„ç«¯å£ 3 å¯èƒ½è¿æ¥ s4
```

è®°å½•ä¸‹æ¥ï¼š
- s1 è¿æ¥ s3 çš„ç«¯å£ï¼š`2`
- s1 è¿æ¥ s4 çš„ç«¯å£ï¼š`3`

**æ¸…ç†ç¯å¢ƒï¼š**
```bash
mininet> exit
$ sudo mn -c
```

---

#### æ­¥éª¤ 3ï¼šä¿®æ”¹ loop_breaker_switch.py

**ç¼–è¾‘ `loop_breaker_switch.py` ç¬¬ 79 è¡Œï¼š**

```python
# ä¿®æ”¹ä¸ºå®é™…ç«¯å£å·ï¼ˆä¾‹å¦‚ç¦ç”¨ç«¯å£ 2ï¼‰
target_port = 2  # æ ¹æ®æ­¥éª¤ 2 çš„ç»“æœä¿®æ”¹
```

---

#### æ­¥éª¤ 4ï¼šæµ‹è¯•ç¦ç”¨ç«¯å£æ–¹æ¡ˆ

**ç»ˆç«¯ 1ï¼šå¯åŠ¨æ§åˆ¶å™¨**
```bash
osken-manager loop_breaker_switch.py
```

**ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘ç»œæ‹“æ‰‘**
```bash
sudo ./topo_2.py
```

**Mininet CLI ä¸­ï¼š**
```bash
# æµ‹è¯•è¿é€šæ€§
mininet> h4 ping -c 10 h2
# âœ… åº”è¯¥èƒ½æ­£å¸¸é€šä¿¡

# æŸ¥çœ‹æ§åˆ¶å™¨æ—¥å¿—
# åº”è¯¥çœ‹åˆ°ï¼šPort X on switch 1 has been disabled to break the loop

# å¯åŠ¨ Wireshark éªŒè¯
mininet> h3 wireshark &
# âœ… ä¸å†æœ‰ç¯è·¯ï¼Œåªæœ‰æ­£å¸¸çš„ ARP å’Œ ICMP åŒ…
```

---

#### æ­¥éª¤ 5ï¼šå¯¹æ¯”ä¸åŒç«¯å£çš„å½±å“

**åˆ†åˆ«ç¦ç”¨ç«¯å£ 2 å’Œç«¯å£ 3ï¼Œå¯¹æ¯”é€šä¿¡è·¯å¾„çš„å·®å¼‚ï¼š**

**ç¦ç”¨ s1 çš„ç«¯å£ 2ï¼ˆè¿æ¥ s3ï¼‰ï¼š**
- é€šä¿¡è·¯å¾„ï¼šh4 â†’ s4 â†’ s2 â†’ h2ï¼ˆç»•è¿‡ s3ï¼‰

**ç¦ç”¨ s1 çš„ç«¯å£ 3ï¼ˆè¿æ¥ s4ï¼‰ï¼š**
- é€šä¿¡è·¯å¾„ï¼šh4 â†’ s4 â†’ s3 â†’ s1 â†’ s2 â†’ h2ï¼ˆç»•è¿‡ s1-s4 ç›´è¿ï¼‰

---

### ğŸ“‹ å®éªŒæŠ¥å‘Šè¦æ±‚

#### 1. ç¯è·¯é—®é¢˜è§‚å¯Ÿï¼ˆå¿…éœ€ï¼‰

**æˆªå›¾å’Œè®°å½•**ï¼š
- âœ… è¿è¡Œ `self_learning_switch.py` + `topo_2.py` çš„ ping å¤±è´¥ç»“æœ
- âœ… æ§åˆ¶å™¨è¾“å‡ºï¼šåŒä¸€ä¸ªåŒ…ä»å¤šä¸ªç«¯å£è¿›å…¥ s1ï¼ˆç¯è·¯è¯æ®ï¼‰
- âœ… Wireshark æŠ“åŒ…ï¼šå¤§é‡é‡å¤çš„ ARP Request åŒ…
- âœ… æµè¡¨æŸ¥çœ‹ï¼š`dpctl dump-flows` æ˜¾ç¤º n_packets æ•°é‡å·¨å¤§

**åˆ†æè¯´æ˜**ï¼š
- è¯´æ˜ä¸ºä»€ä¹ˆä¼šå‡ºç° "Destination Host Unreachable"
- è§£é‡Šç¯è·¯å½¢æˆçš„åŸå› ï¼ˆs1-s3-s4 ä¹‹é—´çš„å¤šæ¡é“¾è·¯ï¼‰
- åˆ†æ ARP å¹¿æ’­åœ¨ç¯è·¯ä¸­çš„ä¼ æ’­è¿‡ç¨‹

#### 2. ç«¯å£å·è¯†åˆ«ï¼ˆå¿…éœ€ï¼‰

**è®°å½•å†…å®¹**ï¼š
```
s1 çš„ç«¯å£æ˜ å°„ï¼š
- ç«¯å£ 1ï¼šè¿æ¥ h1ï¼ˆä¸»æœºï¼‰
- ç«¯å£ 2ï¼šè¿æ¥ s2ï¼ˆäº¤æ¢æœºï¼‰
- ç«¯å£ 3ï¼šè¿æ¥ s3ï¼ˆäº¤æ¢æœºï¼‰
- ç«¯å£ 4ï¼šè¿æ¥ s4ï¼ˆäº¤æ¢æœºï¼‰
```

**åˆ†ææ–¹æ³•**ï¼š
- ä»æ§åˆ¶å™¨è¾“å‡ºçš„ `dpid=1, in_port=X` åˆ¤æ–­ç«¯å£å·
- ä½¿ç”¨ `sh ovs-ofctl show s1` å‘½ä»¤æŸ¥çœ‹ç«¯å£è¿æ¥ä¿¡æ¯

#### 3. ç¦ç”¨ç«¯å£å®éªŒï¼ˆå¿…éœ€ï¼‰

**å®éªŒè®°å½•**ï¼š

| æµ‹è¯•åœºæ™¯ | ç¦ç”¨ç«¯å£ | Ping ç»“æœ | è¯´æ˜ |
|---------|---------|----------|------|
| åœºæ™¯ 1 | ç«¯å£ 3 (s1-s3) | âŒ å¤±è´¥ | ç¯è·¯æœªå®Œå…¨æ¶ˆé™¤ï¼Œs1-s2-...-s4 ä»å½¢æˆç¯è·¯ |
| åœºæ™¯ 2 | ç«¯å£ 4 (s1-s4) | âŒ å¤±è´¥ | ç¯è·¯æœªå®Œå…¨æ¶ˆé™¤ï¼Œs1-s3-s4 ä»é€šè¿‡ s3-s4 ç›´è¿å½¢æˆç¯è·¯ |

**å…³é”®å‘ç°**ï¼š
- å•ä¸€ç«¯å£ç¦ç”¨**æ— æ³•è§£å†³**æ­¤æ‹“æ‰‘çš„ç¯è·¯é—®é¢˜
- éœ€è¦ç¦ç”¨**å¤šä¸ªç«¯å£**æˆ–ä½¿ç”¨**æ›´æ™ºèƒ½çš„æ–¹æ³•**

#### 4. æ–¹æ³•å±€é™æ€§åˆ†æï¼ˆé‡ç‚¹ï¼ï¼‰

**ä¸ºä»€ä¹ˆç¦ç”¨ç«¯å£æ–¹æ³•å¤±è´¥äº†ï¼Ÿ**

1. **æ‹“æ‰‘å¤æ‚åº¦**ï¼š
   - topo_2.py è®¾è®¡äº†å¤šä¸ªç›¸äº’åµŒå¥—çš„ç¯è·¯
   - s3-s4 ä¹‹é—´æœ‰ç›´è¿é“¾è·¯ï¼Œå½¢æˆç‹¬ç«‹çš„ç¯è·¯åˆ†æ”¯

2. **ç«¯å£ç¦ç”¨çš„å±€é™**ï¼š
   - éœ€è¦é¢„å…ˆçŸ¥é“å®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘
   - åœ¨å¤æ‚ç¯è·¯ä¸­ï¼Œå¯èƒ½éœ€è¦ç¦ç”¨å¤šä¸ªç«¯å£
   - ç¦ç”¨ç«¯å£ä¼šæ°¸ä¹…æ”¹å˜ç½‘ç»œç»“æ„ï¼Œé™ä½å†—ä½™æ€§

3. **å®é™…ç½‘ç»œåœºæ™¯**ï¼š
   - ç”Ÿäº§ç¯å¢ƒä¸­çš„ç½‘ç»œæ‹“æ‰‘å¾€å¾€æ¯”å®éªŒæ›´å¤æ‚
   - åŠ¨æ€å˜åŒ–çš„ç½‘ç»œéœ€è¦åŠ¨æ€çš„è§£å†³æ–¹æ¡ˆ
   - ç¦ç”¨ç«¯å£æ–¹æ³•ä¸é€‚åˆå¤§è§„æ¨¡ç½‘ç»œ

**å®éªŒè®¾è®¡æ„å›¾**ï¼š
- æ•…æ„è®¾è®¡å¤æ‚æ‹“æ‰‘ï¼Œè®©ç¦ç”¨ç«¯å£æ–¹æ³•å¤±æ•ˆ
- å¼•å‡ºä»»åŠ¡äºŒä¹‹äºŒçš„é€šç”¨è§£å†³æ–¹æ¡ˆ

### âœ… ä»»åŠ¡äºŒä¹‹ä¸€éªŒè¯æ¸…å•

- [ ] è§‚å¯Ÿåˆ°ç¯è·¯é—®é¢˜ï¼ˆping å¤±è´¥ï¼Œæµè¡¨ n_packets å·¨å¤§ï¼‰
- [ ] æ‰¾å‡º s1 è¿æ¥ s3 å’Œ s4 çš„ç«¯å£å·ï¼ˆ3 å’Œ 4ï¼‰
- [ ] æµ‹è¯•ç¦ç”¨ç«¯å£ 3 å’Œç«¯å£ 4ï¼ˆé¢„æœŸï¼šå¯èƒ½éƒ½æ— æ³•å®Œå…¨è§£å†³ï¼‰
- [ ] ç†è§£ç«¯å£ç¦ç”¨æ–¹æ³•çš„å±€é™æ€§
- [ ] æˆªå›¾ä¿å­˜ç¯è·¯é—®é¢˜çš„å„ç§ç°è±¡

---

## ğŸ” ä»»åŠ¡äºŒä¹‹äºŒï¼šè½¬å‘å†å²ä¿¡æ¯è§£å†³ç¯è·¯å¹¿æ’­

### ğŸ¯ ä»»åŠ¡ç›®æ ‡

é€šè¿‡è®°å½• ARP Request è½¬å‘å†å²ï¼Œæ£€æµ‹å¹¶é˜»æ–­ç¯è·¯ã€‚

### ğŸŒ ç½‘ç»œæ‹“æ‰‘

ä¸ä»»åŠ¡äºŒä¹‹ä¸€ç›¸åŒï¼ˆ`topo_2.py`ï¼‰ã€‚

### ğŸ”§ å®éªŒæ­¥éª¤

#### æ­¥éª¤ 1ï¼šæµ‹è¯•ç¯è·¯æ£€æµ‹æ–¹æ¡ˆ

**ç»ˆç«¯ 1ï¼šå¯åŠ¨æ§åˆ¶å™¨**
```bash
osken-manager loop_detecting_switch.py
```

**ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘ç»œæ‹“æ‰‘**
```bash
sudo ./topo_2.py
```

**Mininet CLI ä¸­ï¼š**
```bash
# æµ‹è¯•è¿é€šæ€§
mininet> h4 ping -c 10 h2
# âœ… åº”è¯¥èƒ½æ­£å¸¸é€šä¿¡

# å¯åŠ¨ Wireshark éªŒè¯
mininet> h3 wireshark &
# âœ… ä¸å†æœ‰ç¯è·¯
```

---

#### æ­¥éª¤ 2ï¼šè§‚å¯Ÿæ§åˆ¶å™¨æ—¥å¿—

**æ§åˆ¶å™¨è¾“å‡ºç¤ºä¾‹**ï¼š

```
Recording ARP request: dpid=1, src=00:00:00:00:00:04, dst_ip=10.0.0.2, in_port=3
Recording ARP request: dpid=3, src=00:00:00:00:00:04, dst_ip=10.0.0.2, in_port=1
Loop detected! Dropping ARP request: dpid=1, src=00:00:00:00:00:04, dst_ip=10.0.0.2, in_port=2 (previous port=3)
```

**æ—¥å¿—åˆ†æ**ï¼š
1. **ç¬¬ä¸€æ¬¡è®°å½•**ï¼šs1 ä»ç«¯å£ 3 æ”¶åˆ° h4 å‘å‡ºçš„ ARP Request
2. **ç¬¬äºŒæ¬¡è®°å½•**ï¼šs3 ä»ç«¯å£ 1 æ”¶åˆ°ç›¸åŒçš„ ARP Request
3. **ç¯è·¯æ£€æµ‹**ï¼šs1 å†æ¬¡ä»ç«¯å£ 2 æ”¶åˆ°ç›¸åŒçš„ ARP Requestï¼ˆè¯´æ˜ç¯è·¯ï¼‰â†’ ä¸¢å¼ƒï¼

---

#### æ­¥éª¤ 3ï¼šç¯è·¯åˆ¤æ–­é€»è¾‘è¯´æ˜

**æ ¸å¿ƒæ€æƒ³**ï¼š
- ç»´æŠ¤æ˜ å°„è¡¨ `sw`ï¼š`(dpid, src_mac, dst_ip) -> in_port`
- å¦‚æœåŒä¸€ä¸ª `(dpid, src_mac, dst_ip)` ä»ä¸åŒç«¯å£æ”¶åˆ° â†’ æ£€æµ‹åˆ°ç¯è·¯ â†’ ä¸¢å¼ƒ

**ä¸¾ä¾‹è¯´æ˜**ï¼š

å‡è®¾ h4 (MAC: `00:00:00:00:00:04`, IP: `10.0.0.4`) è¦ ping h2 (IP: `10.0.0.2`)ï¼š

1. **h4 å‘å‡º ARP Request**ï¼šè¯¢é—®è°æœ‰ `10.0.0.2`
2. **å¹¿æ’­ä¼ æ’­è·¯å¾„**ï¼š
   ```
   h4 â†’ s4 â†’ s1 (ç«¯å£3) â†’ s3 (ç¯è·¯)
               â†“
             s2 â†’ h2 âœ…
   ```
3. **ç¯è·¯æ£€æµ‹**ï¼š
   - s1 ç¬¬ä¸€æ¬¡ä»ç«¯å£ 3 æ”¶åˆ° â†’ è®°å½• `(1, 00:00:00:00:00:04, 10.0.0.2) -> 3`
   - s1 ç»è¿‡ç¯è·¯åä»ç«¯å£ 2 åˆæ”¶åˆ°åŒæ ·çš„åŒ… â†’ æ£€æµ‹åˆ°ç¯è·¯ â†’ ä¸¢å¼ƒï¼

---

### ğŸ“‹ å®éªŒæŠ¥å‘Šè¦æ±‚

#### 1. ç¯è·¯æ£€æµ‹æˆåŠŸéªŒè¯ï¼ˆå¿…éœ€ï¼‰

**æˆªå›¾å’Œè®°å½•**ï¼š
```
Ping ç»“æœï¼š
- 10 packets transmitted, 10 received, 0% packet loss âœ…
- å»¶è¿Ÿæ­£å¸¸ï¼ˆ< 15msï¼‰
```

**æ§åˆ¶å™¨æ—¥å¿—ç¤ºä¾‹**ï¼š
```
Recording ARP request: dpid=1, src=XX:XX:XX:XX:XX:XX, dst_ip=10.0.0.2, in_port=2
Recording ARP request: dpid=4, src=XX:XX:XX:XX:XX:XX, dst_ip=10.0.0.2, in_port=1
Loop detected! Dropping ARP request: dpid=1, src=XX:XX:XX:XX:XX:XX, dst_ip=10.0.0.2, in_port=3
Packet matched: dpid=2, src=..., in_port=1, dst=..., out_port=2
```

#### 2. ç¯è·¯åˆ¤æ–­é€»è¾‘è¯´æ˜ï¼ˆé‡ç‚¹ï¼ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼š
```
æ•°æ®ç»“æ„ï¼šself.sw = {(dpid, src_mac, dst_ip): in_port}

æ£€æµ‹é€»è¾‘ï¼š
1. ç¬¬ä¸€æ¬¡æ”¶åˆ° ARP Request â†’ è®°å½• (dpid, src_mac, dst_ip) -> in_port
2. å†æ¬¡æ”¶åˆ°ç›¸åŒ ARP Requestï¼š
   - å¦‚æœ in_port ç›¸åŒ â†’ é‡ä¼ ï¼Œæ­£å¸¸å¤„ç†
   - å¦‚æœ in_port ä¸åŒ â†’ ç¯è·¯ï¼ä¸¢å¼ƒåŒ…
```

**ä¸¾ä¾‹è¯´æ˜**ï¼ˆå¿…éœ€ï¼ï¼‰ï¼š

å‡è®¾ h4 (MAC: `aa:aa:aa:aa:aa:aa`) ping h2 (IP: `10.0.0.2`)

**æ­¥éª¤ 1**ï¼šh4 å‘å‡º ARP Request å¹¿æ’­
```
ARP Request: "Who has 10.0.0.2? Tell 10.0.0.4"
```

**æ­¥éª¤ 2**ï¼šå¹¿æ’­åœ¨ç½‘ç»œä¸­ä¼ æ’­
```
h4 â†’ s4 (port 1) â†’ s1 (port 4)
                  â†“
è®°å½•ï¼šsw[(1, aa:aa:aa:aa:aa:aa, 10.0.0.2)] = 4
                  â†“
è½¬å‘åˆ° s2ï¼ˆæ­£å¸¸è·¯å¾„ï¼‰âœ…
è½¬å‘åˆ° s3ï¼ˆè¿›å…¥ç¯è·¯ï¼‰
```

**æ­¥éª¤ 3**ï¼šç¯è·¯è¿”å›
```
s3 â†’ s4 â†’ s1 (port 4 å†æ¬¡æ”¶åˆ°)

æ£€æŸ¥ï¼š
- Key: (1, aa:aa:aa:aa:aa:aa, 10.0.0.2)
- å·²å­˜åœ¨ï¼Ÿæ˜¯
- ä¹‹å‰çš„ port: 4
- ç°åœ¨çš„ port: 4
- åˆ¤å®šï¼šç›¸åŒç«¯å£ï¼Œå¯èƒ½æ˜¯é‡ä¼  â†’ å¤„ç†ï¼ˆå®é™…ä¸Šä¼šå†æ£€æµ‹å…¶ä»–ç«¯å£ï¼‰

ç»§ç»­ï¼š
s3 â†’ s1 (port 3 æ”¶åˆ°)

æ£€æŸ¥ï¼š
- Key: (1, aa:aa:aa:aa:aa:aa, 10.0.0.2)  
- å·²å­˜åœ¨ï¼Ÿæ˜¯
- ä¹‹å‰çš„ port: 4
- ç°åœ¨çš„ port: 3  â† ä¸åŒï¼
- åˆ¤å®šï¼šç¯è·¯ï¼ â†’ ä¸¢å¼ƒåŒ… âŒ
```

**æ­¥éª¤ 4**ï¼šæ­£å¸¸é€šä¿¡ç»§ç»­
```
h2 ä»æ­£å¸¸è·¯å¾„æ”¶åˆ° ARP Request
h2 å›å¤ ARP Reply
h4 æ”¶åˆ° Replyï¼Œå­¦ä¹ åˆ° MAC åœ°å€
å¼€å§‹ ICMP pingï¼ˆæˆåŠŸï¼‰âœ…
```

#### 3. å¯¹æ¯”ä¸¤ç§æ–¹æ³•ï¼ˆé‡ç‚¹ï¼ï¼‰

| å¯¹æ¯”é¡¹ | ç¦ç”¨ç«¯å£æ–¹æ³• | è½¬å‘å†å²æ£€æµ‹æ–¹æ³• |
|-------|-------------|----------------|
| **åŸç†** | ç‰©ç†æ–­å¼€é“¾è·¯ | æ™ºèƒ½è¯†åˆ«ç¯è·¯åŒ… |
| **å®ç°éš¾åº¦** | ç®€å•ï¼ˆä¸€è¡Œä»£ç ï¼‰ | ä¸­ç­‰ï¼ˆéœ€è¦ç»´æŠ¤çŠ¶æ€ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•å•ç¯æ‹“æ‰‘ | å¤æ‚å¤šç¯æ‹“æ‰‘ âœ… |
| **æ‹“æ‰‘è¦æ±‚** | éœ€é¢„çŸ¥æ‹“æ‰‘ç»“æ„ | è‡ªåŠ¨é€‚åº” âœ… |
| **å¯¹ç½‘ç»œå½±å“** | æ°¸ä¹…æ”¹å˜ç»“æ„ | ä¸æ”¹å˜ç‰©ç†ç»“æ„ âœ… |
| **å†—ä½™æ€§** | é™ä½å†—ä½™æ€§ | ä¿æŒå†—ä½™æ€§ âœ… |
| **å¯æ‰©å±•æ€§** | éš¾ä»¥æ‰©å±• | å®¹æ˜“æ‰©å±• âœ… |
| **topo_2 æ•ˆæœ** | âŒ å¤±è´¥ | âœ… æˆåŠŸ |

**ç»“è®º**ï¼š
- ç¦ç”¨ç«¯å£æ–¹æ³•é€‚åˆ**ç®€å•ã€å·²çŸ¥**çš„æ‹“æ‰‘
- è½¬å‘å†å²æ£€æµ‹æ–¹æ³•æ˜¯**æ›´é€šç”¨ã€æ™ºèƒ½**çš„è§£å†³æ–¹æ¡ˆ
- å®é™…ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨**ç¯è·¯æ£€æµ‹**æˆ– **STP åè®®**

### âœ… ä»»åŠ¡äºŒä¹‹äºŒéªŒè¯æ¸…å•

- [ ] h4 å’Œ h2 èƒ½æ­£å¸¸é€šä¿¡ï¼ˆ0% packet lossï¼‰
- [ ] æ§åˆ¶å™¨æ—¥å¿—æ˜¾ç¤º "Recording ARP request"
- [ ] æ§åˆ¶å™¨æ—¥å¿—æ˜¾ç¤º "Loop detected! Dropping..."
- [ ] èƒ½å¤Ÿè§£é‡Šç¯è·¯åˆ¤æ–­é€»è¾‘ï¼ˆç”¨è‡ªå·±çš„è¯ï¼‰
- [ ] ä¸¾ä¾‹è¯´æ˜ç¯è·¯æ£€æµ‹çš„å®Œæ•´è¿‡ç¨‹
- [ ] å¯¹æ¯”ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹

---

## ğŸ“ å®éªŒæŠ¥å‘Šæ’°å†™æŒ‡å—

### ğŸ“Š æŠ¥å‘Šç»“æ„å»ºè®®

#### ä¸€ã€å®éªŒç›®çš„ï¼ˆ1 æ®µï¼‰
- ç†è§£ SDN è‡ªå­¦ä¹ æœºåˆ¶
- æŒæ¡ç¯è·¯å¹¿æ’­çš„å½¢æˆåŸå› å’Œé˜²æ²»æ–¹æ³•
- å¯¹æ¯”ä¸åŒç¯è·¯è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹

#### äºŒã€å®éªŒç¯å¢ƒï¼ˆè¡¨æ ¼ï¼‰
```
æ“ä½œç³»ç»Ÿï¼šUbuntu Linux (è™šæ‹Ÿæœº)
å·¥å…·è½¯ä»¶ï¼šMininet, OS-Ken, Wireshark
Python ç‰ˆæœ¬ï¼š3.x
OpenFlow ç‰ˆæœ¬ï¼š1.3
```

#### ä¸‰ã€ä»»åŠ¡ä¸€ï¼šè‡ªå­¦ä¹ äº¤æ¢æœºï¼ˆ2-3 é¡µï¼‰

**3.1 ç®€å•äº¤æ¢æœºçš„ç¼ºé™·**
- æˆªå›¾ï¼šh3 æ”¶åˆ° h4 å’Œ h2 ä¹‹é—´çš„é€šä¿¡
- è¯´æ˜ï¼šæ´ªæ³›å¯¼è‡´æ‰€æœ‰ä¸»æœºæ”¶åˆ°æ— å…³æ•°æ®åŒ…

**3.2 è‡ªå­¦ä¹ äº¤æ¢æœºå®ç°**
- ä»£ç æ ¸å¿ƒé€»è¾‘ï¼ˆMAC åœ°å€å­¦ä¹ è¡¨ï¼‰
- æ§åˆ¶å™¨è¾“å‡ºçš„äº”å…ƒç»„åˆ†æ
- MAC åœ°å€å’Œç«¯å£æ˜ å°„è¡¨

**3.3 Wireshark æŠ“åŒ…åˆ†æ**
- ARP åŒ…åˆ†æï¼ˆ1-4 ä¸ªï¼Œæ­£å¸¸ï¼‰
- ICMP åŒ…åˆ†æï¼ˆ0 ä¸ªæˆ–å¾ˆå°‘ï¼ŒæˆåŠŸï¼‰
- ICMPv6 åŒ…è¯´æ˜ï¼ˆç³»ç»Ÿæµé‡ï¼Œä¸å®éªŒæ— å…³ï¼‰

**3.4 hard_timeout å‚æ•°å¯¹æ¯”**
- hard_timeout=0ï¼šæ°¸ä¹…æµè¡¨
- hard_timeout=5ï¼š5 ç§’å¤±æ•ˆ
- å¯¹æ¯”è¡¨æ ¼å’Œåˆ†æ

#### å››ã€ä»»åŠ¡äºŒä¹‹ä¸€ï¼šç¦ç”¨ç«¯å£ï¼ˆ2-3 é¡µï¼‰

**4.1 ç¯è·¯é—®é¢˜è§‚å¯Ÿ**
- æˆªå›¾ï¼šping å¤±è´¥ï¼ˆDestination Host Unreachableï¼‰
- æˆªå›¾ï¼šæ§åˆ¶å™¨è¾“å‡ºï¼ˆåŒä¸€åŒ…ä»å¤šä¸ªç«¯å£è¿›å…¥ï¼‰
- æˆªå›¾ï¼šWiresharkï¼ˆå¤§é‡é‡å¤ ARP Requestï¼‰
- æˆªå›¾ï¼šæµè¡¨ n_packets å·¨å¤§

**4.2 ç«¯å£å·è¯†åˆ«**
- s1 çš„ç«¯å£æ˜ å°„è¡¨
- è¯†åˆ«æ–¹æ³•è¯´æ˜

**4.3 ç¦ç”¨ç«¯å£å®éªŒ**
- ç¦ç”¨ç«¯å£ 3 çš„ç»“æœï¼ˆå¤±è´¥åŸå› ï¼‰
- ç¦ç”¨ç«¯å£ 4 çš„ç»“æœï¼ˆå¤±è´¥åŸå› ï¼‰

**4.4 æ–¹æ³•å±€é™æ€§åˆ†æ**ï¼ˆé‡ç‚¹ï¼ï¼‰
- ä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿ
- å¤æ‚æ‹“æ‰‘çš„æŒ‘æˆ˜
- å®é™…åº”ç”¨åœºæ™¯çš„é™åˆ¶

#### äº”ã€ä»»åŠ¡äºŒä¹‹äºŒï¼šè½¬å‘å†å²æ£€æµ‹ï¼ˆ3-4 é¡µï¼‰

**5.1 ç¯è·¯æ£€æµ‹æˆåŠŸéªŒè¯**
- æˆªå›¾ï¼šping æˆåŠŸï¼ˆ0% lossï¼‰
- æˆªå›¾ï¼šæ§åˆ¶å™¨æ—¥å¿—ï¼ˆRecording + Loop detectedï¼‰

**5.2 ç¯è·¯åˆ¤æ–­é€»è¾‘è¯¦è§£**ï¼ˆé‡ç‚¹ï¼ï¼‰
- æ•°æ®ç»“æ„è¯´æ˜
- æ£€æµ‹ç®—æ³•æµç¨‹å›¾
- ä¸¾ä¾‹è¯´æ˜ï¼ˆh4 â†’ h2 çš„å®Œæ•´è¿‡ç¨‹ï¼‰

**5.3 æ–¹æ³•å¯¹æ¯”åˆ†æ**
- å¯¹æ¯”è¡¨æ ¼
- ä¼˜ç¼ºç‚¹åˆ†æ
- é€‚ç”¨åœºæ™¯è®¨è®º

#### å…­ã€å®éªŒæ€»ç»“ï¼ˆ1-2 æ®µï¼‰
- å®éªŒæ”¶è·
- å¯¹ SDN çš„ç†è§£
- ç¯è·¯é—®é¢˜çš„å¯ç¤º

#### ä¸ƒã€æ€è€ƒé¢˜ï¼ˆå¯é€‰ï¼‰
- å¦‚æœç½‘ç»œæ‹“æ‰‘æœ‰æ›´å¤šç¯è·¯ï¼Œå¦‚ä½•æ‰©å±•è§£å†³æ–¹æ¡ˆï¼Ÿ
- STP åè®®ä¸æœ¬å®éªŒæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ
- å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²ç±»ä¼¼æœºåˆ¶ï¼Ÿ

---

### ğŸ“¸ å¿…éœ€çš„æˆªå›¾æ¸…å•

#### ä»»åŠ¡ä¸€ï¼ˆ6 å¼ ï¼‰
1. âœ… simple_switch.py è¿è¡Œç»“æœï¼ˆh3 æ”¶åˆ°æ— å…³åŒ…ï¼‰
2. âœ… self_learning_switch.py æ§åˆ¶å™¨è¾“å‡ºï¼ˆäº”å…ƒç»„ï¼‰
3. âœ… Wireshark è¿‡æ»¤ arp çš„ç»“æœ
4. âœ… Wireshark è¿‡æ»¤ icmp çš„ç»“æœï¼ˆç©ºæˆ–å¾ˆå°‘ï¼‰
5. âœ… ping æˆåŠŸæˆªå›¾ï¼ˆ0% lossï¼‰
6. âœ… hard_timeout=5 æ—¶çš„æ§åˆ¶å™¨è¾“å‡ºå¯¹æ¯”

#### ä»»åŠ¡äºŒä¹‹ä¸€ï¼ˆ5 å¼ ï¼‰
1. âœ… ç¯è·¯é—®é¢˜ï¼šping å¤±è´¥æˆªå›¾
2. âœ… ç¯è·¯é—®é¢˜ï¼šæ§åˆ¶å™¨è¾“å‡ºï¼ˆç¯è·¯è¯æ®ï¼‰
3. âœ… ç¯è·¯é—®é¢˜ï¼šWireshark å¤§é‡ ARP Request
4. âœ… ç¯è·¯é—®é¢˜ï¼šæµè¡¨ n_packets å·¨å¤§
5. âœ… ovs-ofctl show s1 çš„è¾“å‡ºï¼ˆç«¯å£ä¿¡æ¯ï¼‰

#### ä»»åŠ¡äºŒä¹‹äºŒï¼ˆ3 å¼ ï¼‰
1. âœ… ping æˆåŠŸæˆªå›¾
2. âœ… æ§åˆ¶å™¨æ—¥å¿—ï¼šRecording ARP request
3. âœ… æ§åˆ¶å™¨æ—¥å¿—ï¼šLoop detected! Dropping...

---

### ğŸ“‹ å®éªŒæ•°æ®è®°å½•æ¨¡æ¿

#### ä»»åŠ¡ä¸€æ•°æ®è®°å½•

```
ä¸»æœº MAC åœ°å€ï¼š
- h1: __:__:__:__:__:__
- h2: __:__:__:__:__:__
- h3: __:__:__:__:__:__
- h4: __:__:__:__:__:__

é€šä¿¡è·¯å¾„ï¼ˆh4 â†’ h2ï¼‰ï¼š
å»ç¨‹ï¼šh4 â†’ s__ (port__) â†’ s__ (port__) â†’ ... â†’ h2
å›ç¨‹ï¼šh2 â†’ s__ (port__) â†’ s__ (port__) â†’ ... â†’ h4

hard_timeout å¯¹æ¯”ï¼š
- hard_timeout=0ï¼šæ§åˆ¶å™¨è¾“å‡º __ æ¬¡
- hard_timeout=5ï¼šæ§åˆ¶å™¨è¾“å‡º __ æ¬¡ï¼ˆæ¯ 5 ç§’ï¼‰
```

#### ä»»åŠ¡äºŒæ•°æ®è®°å½•

```
ç«¯å£æ˜ å°„ï¼š
- s1 ç«¯å£ 1ï¼šè¿æ¥ ____
- s1 ç«¯å£ 2ï¼šè¿æ¥ ____
- s1 ç«¯å£ 3ï¼šè¿æ¥ ____
- s1 ç«¯å£ 4ï¼šè¿æ¥ ____

ç¦ç”¨ç«¯å£å®éªŒï¼š
- ç¦ç”¨ç«¯å£ 3ï¼šç»“æœ ______ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰ï¼ŒåŸå›  ______
- ç¦ç”¨ç«¯å£ 4ï¼šç»“æœ ______ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰ï¼ŒåŸå›  ______

ç¯è·¯æ£€æµ‹ï¼š
- ç¬¬ä¸€æ¬¡è®°å½•ï¼šdpid=__, src=______, dst_ip=______, in_port=__
- ç¯è·¯æ£€æµ‹ï¼šdpid=__, in_port=__ (previous port=__)
- Ping ç»“æœï¼š__ packets transmitted, __ received, __% loss
```

---

### ğŸ’¡ æŠ¥å‘Šæ’°å†™æŠ€å·§

1. **æˆªå›¾æ¸…æ™°**ï¼š
   - ä½¿ç”¨è™šæ‹Ÿæœºæˆªå›¾å·¥å…·æˆ–å±å¹•å½•åˆ¶
   - æ ‡æ³¨å…³é”®ä¿¡æ¯ï¼ˆç”¨çº¢æ¡†æˆ–ç®­å¤´ï¼‰
   - å›¾ç‰‡ä¸‹æ–¹æ·»åŠ è¯´æ˜æ–‡å­—

2. **æ•°æ®çœŸå®**ï¼š
   - ä½¿ç”¨å®é™…å®éªŒçš„ MAC åœ°å€å’Œç«¯å£å·
   - ä¸è¦ç¼–é€ æ•°æ®

3. **åˆ†ææ·±å…¥**ï¼š
   - ä¸åªæ˜¯æè¿°ç°è±¡ï¼Œè¦åˆ†æåŸå› 
   - å¯¹æ¯”å®éªŒç»“æœï¼Œå¾—å‡ºç»“è®º
   - è”ç³»ç†è®ºçŸ¥è¯†ï¼ˆARPã€MAC å­¦ä¹ ã€ç¯è·¯ï¼‰

4. **é€»è¾‘æ¸…æ™°**ï¼š
   - é—®é¢˜ â†’ æ–¹æ³• â†’ ç»“æœ â†’ åˆ†æ
   - ä½¿ç”¨è¡¨æ ¼ã€æµç¨‹å›¾ç­‰å¯è§†åŒ–å·¥å…·
   - ä»£ç å…³é”®éƒ¨åˆ†åŠ æ³¨é‡Šè¯´æ˜

5. **é‡ç‚¹çªå‡º**ï¼š
   - ä»»åŠ¡äºŒçš„æ–¹æ³•å¯¹æ¯”æ˜¯æŠ¥å‘Šçš„æ ¸å¿ƒ
   - ICMPv6 çš„è¯´æ˜è¦æ¸…æ¥š
   - ç¯è·¯æ£€æµ‹é€»è¾‘è¦è¯¦ç»†

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### Mininet CLI å‘½ä»¤

```bash
# æŸ¥çœ‹ç½‘ç»œæ‹“æ‰‘
mininet> net

# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
mininet> nodes

# æŸ¥çœ‹é“¾è·¯
mininet> links

# ä¸»æœº ping æµ‹è¯•
mininet> h1 ping -c 3 h2

# æµ‹è¯•å…¨ç½‘è¿é€šæ€§
mininet> pingall

# æŸ¥çœ‹æ‰€æœ‰äº¤æ¢æœºæµè¡¨
mininet> dpctl dump-flows

# å¯åŠ¨ Wireshark
mininet> h1 wireshark &

# é€€å‡º
mininet> exit
```

### OVS å‘½ä»¤ï¼ˆåœ¨æ™®é€šç»ˆç«¯ï¼‰

```bash
# æŸ¥çœ‹æŸä¸ªäº¤æ¢æœºçš„æµè¡¨
sudo ovs-ofctl dump-flows s1

# æŸ¥çœ‹äº¤æ¢æœºç«¯å£ä¿¡æ¯
sudo ovs-ofctl show s1

# æŸ¥çœ‹äº¤æ¢æœºé…ç½®
sudo ovs-vsctl show
```

### ç¯å¢ƒç®¡ç†

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate

# æ¸…ç† Mininet
sudo mn -c
```

---

## ğŸ“Š å®éªŒæŠ¥å‘Šè¦ç‚¹

### ä»»åŠ¡ä¸€ï¼šè‡ªå­¦ä¹ äº¤æ¢æœº

1. **ç®€å•äº¤æ¢æœºçš„ç¼ºé™·**ï¼š
   - æˆªå›¾ï¼šh3 æ”¶åˆ° h4 å’Œ h2 ä¹‹é—´çš„é€šä¿¡åŒ…
   - è¯´æ˜ï¼šæ´ªæ³›å¯¼è‡´æ‰€æœ‰ç«¯å£éƒ½æ”¶åˆ°åŒ…

2. **è‡ªå­¦ä¹ äº¤æ¢æœºçš„æ”¹è¿›**ï¼š
   - æˆªå›¾ï¼šh3 ä¸å†æ”¶åˆ° h4 å’Œ h2 ä¹‹é—´çš„ ICMP åŒ…
   - æ§åˆ¶å™¨æ—¥å¿—ï¼šäº”å…ƒç»„ä¿¡æ¯

3. **MAC åœ°å€å’Œç«¯å£åˆ†æ**ï¼š
   - æŒ‡å‡º h2ã€h4 çš„ MAC åœ°å€
   - æŒ‡å‡ºå®ƒä»¬è¿æ¥çš„äº¤æ¢æœºå’Œç«¯å£å·

4. **hard_timeout å‚æ•°å¯¹æ¯”**ï¼š
   - `hard_timeout=0`ï¼šæ§åˆ¶å™¨åªåœ¨å­¦ä¹ é˜¶æ®µè¾“å‡º
   - `hard_timeout=5`ï¼šæ¯ 5 ç§’é‡æ–°å­¦ä¹ 

### ä»»åŠ¡äºŒä¹‹ä¸€ï¼šç¦ç”¨ç«¯å£

1. **ç¯è·¯é—®é¢˜è§‚å¯Ÿ**ï¼š
   - æˆªå›¾ï¼šæµè¡¨ä¸­ n_packets æ•°é‡å·¨å¤§
   - æˆªå›¾ï¼šWireshark ä¸­å¤§é‡é‡å¤ ARP Request

2. **ç«¯å£å·åˆ†æ**ï¼š
   - æŒ‡å‡º s1 è¿æ¥ s3 çš„ç«¯å£å·
   - æŒ‡å‡º s1 è¿æ¥ s4 çš„ç«¯å£å·

3. **ç¦ç”¨ç«¯å£æ•ˆæœ**ï¼š
   - æˆªå›¾ï¼šç¦ç”¨å ping æˆåŠŸ
   - åˆ†æï¼šä¸åŒç«¯å£ç¦ç”¨å¯¹è·¯å¾„çš„å½±å“

### ä»»åŠ¡äºŒä¹‹äºŒï¼šè½¬å‘å†å²æ£€æµ‹

1. **ç¯è·¯æ£€æµ‹æ—¥å¿—**ï¼š
   - æˆªå›¾ï¼šæ§åˆ¶å™¨è¾“å‡ºçš„ç¯è·¯æ£€æµ‹ä¿¡æ¯

2. **é€»è¾‘è¯´æ˜**ï¼š
   - è§£é‡Š `(dpid, src_mac, dst_ip) -> in_port` æ˜ å°„è¡¨
   - ä¸¾ä¾‹è¯´æ˜å¦‚ä½•æ£€æµ‹ç¯è·¯

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. è™šæ‹Ÿç¯å¢ƒæ¿€æ´»å¤±è´¥

```bash
# ç¡®ä¿åœ¨ lab2 ç›®å½•ä¸‹
cd ~/æ¡Œé¢/lab/lab2

# æ£€æŸ¥ .venv æ˜¯å¦å­˜åœ¨
ls -la .venv

# å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°åŒæ­¥
uv sync
```

### 2. æ‹“æ‰‘æ–‡ä»¶æ— æ³•è¿è¡Œ

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x topo_1.py topo_2.py

# æ£€æŸ¥ shebang
head -n 1 topo_1.py
# åº”è¯¥æ˜¯ï¼š#!/usr/bin/env python3
```

### 3. æ§åˆ¶å™¨æ— æ³•è¿æ¥

```bash
# ç¡®ä¿ç«¯å£ 6633 æœªè¢«å ç”¨
sudo netstat -tulpn | grep 6633

# æ¸…ç†æ—§çš„ Mininet è¿›ç¨‹
sudo mn -c
```

### 4. Wireshark æ— æ³•å¯åŠ¨

```bash
# ç¡®ä¿å®‰è£…äº† Wireshark
sudo apt install wireshark

# æ·»åŠ ç”¨æˆ·æƒé™
sudo usermod -aG wireshark $USER

# é‡æ–°ç™»å½•åç”Ÿæ•ˆ
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [OS-Ken å®˜æ–¹æ–‡æ¡£](https://docs.openstack.org/os-ken/latest/)
- [Mininet å®˜æ–¹æ–‡æ¡£](http://mininet.org/)
- [OpenFlow è§„èŒƒ](https://www.opennetworking.org/software-defined-standards/specifications/)
- [SDN Lab è®ºå›](https://www.sdnlab.com/)

---

## âœ… å®éªŒå®Œæˆæ£€æŸ¥æ¸…å•

### ä»»åŠ¡ä¸€
- [ ] ç†è§£ç®€å•äº¤æ¢æœºçš„æ´ªæ³›æœºåˆ¶
- [ ] å®ç° MAC åœ°å€è‡ªå­¦ä¹ 
- [ ] èƒ½å¤Ÿåˆ†æ MAC åœ°å€å’Œç«¯å£æ˜ å°„
- [ ] ç†è§£æµè¡¨è¶…æ—¶å‚æ•°çš„ä½œç”¨

### ä»»åŠ¡äºŒä¹‹ä¸€
- [ ] è§‚å¯Ÿç¯è·¯å¹¿æ’­ç°è±¡
- [ ] æ‰¾å‡ºäº¤æ¢æœºç«¯å£å·
- [ ] ä½¿ç”¨ OFPPortMod ç¦ç”¨ç«¯å£
- [ ] åˆ†æä¸åŒç«¯å£ç¦ç”¨çš„å½±å“

### ä»»åŠ¡äºŒä¹‹äºŒ
- [ ] å®ç° ARP è½¬å‘å†å²è®°å½•
- [ ] æ£€æµ‹å¹¶é˜»æ–­ç¯è·¯
- [ ] èƒ½å¤Ÿè§£é‡Šç¯è·¯æ£€æµ‹é€»è¾‘

---

**å®éªŒå®Œæˆï¼ç¥ä½ é¡ºåˆ©é€šè¿‡ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜… [instruction.md](instruction.md) è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

