# Lab 3 å¿«é€Ÿå¼€å§‹æŒ‡å— ğŸš€

## ğŸ“‹ å‡†å¤‡å·¥ä½œæ¸…å•

- [ ] å·²è¿›å…¥ lab3 ç›®å½•
- [ ] å·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
- [ ] å·²ä¿®æ”¹ OS-Ken æºæ–‡ä»¶ï¼ˆä»»åŠ¡äºŒéœ€è¦ï¼‰
- [ ] å·²æ·»åŠ æ‹“æ‰‘æ–‡ä»¶æ‰§è¡Œæƒé™

## ğŸ”§ ç¯å¢ƒè®¾ç½®

### æ­¥éª¤ 1ï¼šè¿›å…¥ç›®å½•å¹¶è®¾ç½®ç¯å¢ƒ

```bash
cd lab3
source setup.sh
```

### æ­¥éª¤ 2ï¼šæ·»åŠ æ‰§è¡Œæƒé™

```bash
chmod +x topo.py
```

### æ­¥éª¤ 3ï¼šä¿®æ”¹ OS-Ken æºæ–‡ä»¶ï¼ˆä»…ä»»åŠ¡äºŒéœ€è¦ï¼‰

**é‡è¦**ï¼šä»»åŠ¡äºŒéœ€è¦ä¿®æ”¹ OS-Ken æºæ–‡ä»¶ä»¥æ”¯æŒæ—¶å»¶æµ‹é‡ã€‚

æŸ¥çœ‹è¯¦ç»†è¯´æ˜ï¼š
```bash
cat OSKEN_MODIFICATION.md
```

ç¼–è¾‘æ–‡ä»¶ï¼š
```bash
nano .venv/lib/python3.13/site-packages/os_ken/topology/switches.py
```

æˆ–ä½¿ç”¨ VSCodeï¼š
```bash
code .venv/lib/python3.13/site-packages/os_ken/topology/switches.py
```

---

## ğŸ“ ä»»åŠ¡ä¸€ï¼šæœ€å°‘è·³æ•°è·¯å¾„

### ç›®æ ‡
- ç†è§£ LLDP æ‹“æ‰‘å‘ç°
- å®ç° ARP ç¯è·¯æ£€æµ‹
- ä½¿ç”¨ NetworkX è®¡ç®—æœ€çŸ­è·¯å¾„

### è¿è¡Œæ­¥éª¤

**ç»ˆç«¯ 1ï¼ˆå¯åŠ¨æ‹“æ‰‘ï¼‰ï¼š**
```bash
sudo ./topo.py
```

**ç»ˆç«¯ 2ï¼ˆå¯åŠ¨æ§åˆ¶å™¨ï¼‰ï¼š**
```bash
uv run osken-manager least_hops.py --observe-links
```

**Mininet CLIï¼ˆæµ‹è¯•ï¼‰ï¼š**
```bash
mininet> h2 ping -c 10 h9
```

### é¢„æœŸç»“æœ

æ§åˆ¶å™¨è¾“å‡ºï¼š
```
path: 10.0.0.2 -> 10.0.0.9
10.0.0.2 -> 1:s2:2 -> 1:s4:3 -> 1:s5:2 -> 3:s9:1 -> 10.0.0.9
```

Ping æˆåŠŸï¼ˆå‰å‡ æ¬¡å¯èƒ½å¤±è´¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„"æ²‰é»˜ä¸»æœº"ç°è±¡ï¼‰ã€‚

---

## ğŸ• ä»»åŠ¡äºŒï¼šæœ€å°æ—¶å»¶è·¯å¾„

### å‰ç½®æ¡ä»¶
âš ï¸ **å¿…é¡»å…ˆå®Œæˆ OS-Ken æºæ–‡ä»¶ä¿®æ”¹ï¼**

### ç›®æ ‡
- æµ‹é‡é“¾è·¯æ—¶å»¶ï¼ˆLLDP + Echoï¼‰
- è®¡ç®—æœ€å°æ—¶å»¶è·¯å¾„
- éªŒè¯ Ping RTT

### è¿è¡Œæ­¥éª¤

**ç»ˆç«¯ 1ï¼ˆå¯åŠ¨æ‹“æ‰‘ï¼‰ï¼š**
```bash
sudo ./topo.py
```

**ç»ˆç«¯ 2ï¼ˆå¯åŠ¨æ§åˆ¶å™¨ï¼‰ï¼š**
```bash
uv run osken-manager shortest_delay.py --observe-links
```

**Mininet CLIï¼ˆæµ‹è¯•ï¼‰ï¼š**
```bash
mininet> h2 ping -c 10 h9
```

### é¢„æœŸç»“æœ

æ§åˆ¶å™¨è¾“å‡ºï¼š
```
Link: 2 -> 3, delay: 32.00000ms
Link: 6 -> 7, delay: 20.00000ms
...
path: 10.0.0.2 -> 10.0.0.9
10.0.0.2 -> ... -> s6 -> s7 -> s8 -> s9 -> 10.0.0.9
link delay dict: {'s2->s4': 80.0, 's4->s5': 110.0, ...}
path delay = 290.00000ms
path RTT = 580.00000ms
```

Ping RTT åº”è¯¥æ¥è¿‘è®¡ç®—çš„ path delayï¼ˆçº¦ 270-290msï¼‰ã€‚

---

## ğŸ”§ ä»»åŠ¡ä¸‰ï¼šé“¾è·¯æ•…éšœå®¹å¿

### ç›®æ ‡
- æ£€æµ‹é“¾è·¯æ•…éšœ
- è‡ªåŠ¨åˆ‡æ¢è·¯å¾„
- æ•…éšœæ¢å¤åè‡ªåŠ¨å›åˆ‡

### è¿è¡Œæ­¥éª¤

ä½¿ç”¨ä»»åŠ¡äºŒçš„ç›¸åŒè®¾ç½®ï¼ˆ`shortest_delay.py`ï¼‰ã€‚

**æµ‹è¯•é“¾è·¯æ•…éšœï¼š**

**æ­¥éª¤ 1ï¼šåˆå§‹çŠ¶æ€**
```bash
mininet> h2 ping h9
# è§‚å¯Ÿ RTTï¼ˆçº¦ 270msï¼‰å’Œè·¯å¾„
```

**æ­¥éª¤ 2ï¼šæ¨¡æ‹Ÿé“¾è·¯æ•…éšœ**
```bash
mininet> link s6 s7 down
# ç»§ç»­ pingï¼Œè§‚å¯Ÿè·¯å¾„è‡ªåŠ¨åˆ‡æ¢
# RTT ä¼šå¢åŠ åˆ°çº¦ 370ms
```

**æ­¥éª¤ 3ï¼šæ¢å¤é“¾è·¯**
```bash
mininet> link s6 s7 up
# è§‚å¯Ÿè·¯å¾„è‡ªåŠ¨æ¢å¤åˆ°æœ€ä¼˜è·¯å¾„
# RTT æ¢å¤åˆ°çº¦ 270ms
```

### é¢„æœŸç»“æœ

**æ•…éšœå‰ï¼š**
```
path: ... -> s6 -> s7 -> s8 -> s9 -> ...
path delay = 270ms
```

**æ•…éšœåï¼š**
```
Port status changed on switch 6, port 2
Topology map cleared
All flow entries deleted
path: ... -> s5 -> s9 -> ...  (ç»•è¿‡ s6-s7)
path delay = 370ms
```

**æ¢å¤åï¼š**
```
Port status changed on switch 6, port 2
Topology map cleared
path: ... -> s6 -> s7 -> s8 -> s9 -> ...  (æ¢å¤æœ€ä¼˜è·¯å¾„)
path delay = 270ms
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ—¶å»¶å‡ºç°è´Ÿå€¼

**ç°è±¡ï¼š**
```
Link: 2 -> 3, delay: -5.23456ms
```

**åŸå› ï¼š**
LLDP å’Œ Echo æµ‹é‡æ˜¯å¼‚æ­¥çš„ï¼Œæ•°æ®å°šæœªå°±ç»ªã€‚

**è§£å†³ï¼š**
ä»£ç ä¸­å·²ç»ä½¿ç”¨ `max(delay, 0)` å¤„ç†ï¼Œç­‰å¾…å‡ ç§’åä¼šè‡ªåŠ¨ä¿®æ­£ã€‚

---

### é—®é¢˜ 2ï¼š"host not find/no path"

**ç°è±¡ï¼š**
```
host not find/no path
host not find/no path
path: 10.0.0.2 -> 10.0.0.9  (ç¬¬3æ¬¡æ‰æˆåŠŸ)
```

**åŸå› ï¼š**
æ²‰é»˜ä¸»æœºç°è±¡ï¼Œä¸»æœºæœªä¸»åŠ¨é€šä¿¡å‰æ§åˆ¶å™¨æ— æ³•æ„ŸçŸ¥ã€‚

**è§£å†³ï¼š**
è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå‰å‡ æ¬¡ ping ä¼šè‡ªåŠ¨è§¦å‘ä¸»æœºå‘ç°ã€‚

---

### é—®é¢˜ 3ï¼šä¿®æ”¹ OS-Ken æºæ–‡ä»¶åæ— æ•ˆ

**åŸå› ï¼š**
Python ä½¿ç”¨äº†ç¼“å­˜çš„ `.pyc` æ–‡ä»¶ã€‚

**è§£å†³ï¼š**
```bash
# åˆ é™¤ç¼“å­˜
find .venv -name "*.pyc" -delete
find .venv -name "__pycache__" -type d -exec rm -rf {} +

# é‡å¯æ§åˆ¶å™¨
```

---

### é—®é¢˜ 4ï¼šé“¾è·¯æ•…éšœå ping ä¸­æ–­

**ç°è±¡ï¼š**
```
Request timeout for icmp_seq 2
Request timeout for icmp_seq 3
64 bytes from 10.0.0.9: icmp_seq=4 ttl=64 time=370 ms
```

**åŸå› ï¼š**
æ‹“æ‰‘é‡æ–°å‘ç°éœ€è¦æ—¶é—´ï¼ˆçº¦ 2-3 ç§’ï¼‰ã€‚

**è§£å†³ï¼š**
è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼Œè¯´æ˜æ•…éšœæ£€æµ‹æ­£å¸¸å·¥ä½œã€‚

---

## ğŸ“¸ å®éªŒæˆªå›¾å»ºè®®

### ä»»åŠ¡ä¸€ï¼ˆ3 å¼ ï¼‰
1. æ§åˆ¶å™¨è¾“å‡ºï¼ˆè·¯å¾„ä¿¡æ¯ï¼‰
2. Ping æˆåŠŸæˆªå›¾
3. ARP ç¯è·¯æ£€æµ‹æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰

### ä»»åŠ¡äºŒï¼ˆ6 å¼ ï¼‰
1. æ§åˆ¶å™¨è¾“å‡ºï¼ˆé“¾è·¯æ—¶å»¶ï¼‰
2. æ§åˆ¶å™¨è¾“å‡ºï¼ˆlink delay dictï¼‰
3. æ§åˆ¶å™¨è¾“å‡ºï¼ˆpath delay å’Œ path RTTï¼‰
4. Ping è¾“å‡ºï¼ˆRTT å¯¹æ¯”ï¼‰
5. ä»£ç æˆªå›¾ï¼ˆcalculate_link_delayï¼‰
6. ä»£ç æˆªå›¾ï¼ˆhandle_echo_replyï¼‰

### ä»»åŠ¡ä¸‰ï¼ˆ6 å¼ ï¼‰
1. åˆå§‹çŠ¶æ€ï¼šæ§åˆ¶å™¨è¾“å‡º
2. åˆå§‹çŠ¶æ€ï¼šPing RTT
3. æ•…éšœçŠ¶æ€ï¼š`link s6 s7 down` å‘½ä»¤
4. æ•…éšœçŠ¶æ€ï¼šæ§åˆ¶å™¨è¾“å‡ºï¼ˆæ–°è·¯å¾„ï¼‰
5. æ¢å¤çŠ¶æ€ï¼š`link s6 s7 up` å‘½ä»¤
6. æ¢å¤çŠ¶æ€ï¼šæ§åˆ¶å™¨è¾“å‡ºï¼ˆæ¢å¤è·¯å¾„ï¼‰

---

## ğŸ§¹ æ¸…ç†ç¯å¢ƒ

**é€€å‡º Mininetï¼š**
```bash
mininet> exit
```

**æ¸…ç† Mininet ç¯å¢ƒï¼š**
```bash
sudo mn -c
```

**åœæ­¢æ§åˆ¶å™¨ï¼š**
```bash
Ctrl + C
```

**é€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼š**
```bash
deactivate
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- è¯¦ç»†å®éªŒæŒ‡å¯¼ï¼š`README.md`
- OS-Ken ä¿®æ”¹è¯´æ˜ï¼š`OSKEN_MODIFICATION.md`
- ä»£ç æ–‡ä»¶ï¼š
  - `least_hops.py` - ä»»åŠ¡ä¸€
  - `shortest_delay.py` - ä»»åŠ¡äºŒå’Œä¸‰
  - `network_awareness.py` - æ‹“æ‰‘å‘ç°å’Œæ—¶å»¶æµ‹é‡

---

**ç¥å®éªŒé¡ºåˆ©ï¼** ğŸ‰

